```{r data generation, echo=FALSE, results='hide'}
pacman::p_load(exams, tidyverse)

# Number of participants in the study (students)
num_students <- 10 + sample(1:15, 1)

# Drink Types and study environments
drink_types <- c("Coffee", "Energy Drink")
study_environments <- c("Library", "Café", "Bedroom")

# Create an empty data frame to store the results

experiment_data <- data.frame(Student = integer(),
                              DrinkType = character(),
                              StudyEnvironment = character(),
                              Alertness = numeric())

# Loop over each student
for (i in 1:num_students) {
  # Randomly assign the number of trials per student (between 5 and 15)
  num_samples <- sample(5:15, 1)
  
  # Randomly assign combinations of coffee and study environment
  student_data <- data.frame(
    Student = rep(i, num_samples),
    DrinkType = sample(drink_types, num_samples, replace = TRUE),
    StudyEnvironment = sample(study_environments, num_samples, replace = TRUE)
  )
   student_data$Alertness <- rnorm(num_samples, mean = 30, sd = 2)  # base mean alertness
  # Now simulate alertness based on drink type, study environment, and residual error
 
  
  # Effects for each factor
  # Drink type effect
  student_data$Alertness[student_data$DrinkType == "Coffee"] <- student_data$Alertness[student_data$DrinkType == "Coffee"] + 5
  student_data$Alertness[student_data$DrinkType == "Energy Drink"] <- student_data$Alertness[student_data$DrinkType == "Energy Drink"] + 3
  
  # Study environment effect
  student_data$Alertness[student_data$StudyEnvironment == "Library"] <- student_data$Alertness[student_data$StudyEnvironment == "Library"] + 3
  student_data$Alertness[student_data$StudyEnvironment == "Café"] <- student_data$Alertness[student_data$StudyEnvironment == "Café"] + 2
  student_data$Alertness[student_data$StudyEnvironment == "Bedroom"] <- student_data$Alertness[student_data$StudyEnvironment == "Bedroom"] + 1
  
  # Interaction between DrinkType and StudyEnvironment (this is the crucial part)
  student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Café"] <- 
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Café"] + 4
  student_data$Alertness[student_data$DrinkType == "Energy Drink" & student_data$StudyEnvironment == "Library"] <- 
    student_data$Alertness[student_data$DrinkType == "Energy Drink" & student_data$StudyEnvironment == "Library"] + 2
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Bedroom"] <- 
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Bedroom"] - 1
  # Add random noise (residual error) to make the data realistic
  student_data$Alertness <- student_data$Alertness + rnorm(num_samples, mean = 0, sd = 10)
  
  # Add the data for the current student to the overall dataset
  experiment_data <- rbind(experiment_data, student_data)
}

myanova <- aov(Alertness ~ DrinkType * StudyEnvironment, data = experiment_data) |> summary()
results <- myanova[[1]] |> as.data.frame() |> round(5)


# QUESTION AND ANSWER GENERATION
choices <- character(4)

choices[1] <- "Students are significantly more alert when drinking coffee than energy drinks, regardless of study environment."
choices[2] <- "Study environment has a statistically significant effect on alertness."
choices[3] <- "The effect of drink type on alertness depends on the study environment."
choices[4] <- "There is insufficient statistical evidence to conclude that drink type, study environment, or their interaction affects alertness."

# Check if any p-values are below 0.05
drink_type_significant <- results$`Pr(>F)`[1] < 0.05
study_environment_significant <- results$`Pr(>F)`[2] < 0.05
interaction_significant <- results$`Pr(>F)`[3] < 0.05

# Create the solution based on the results
sol <- c(
  drink_type_significant, 
  study_environment_significant, 
  interaction_significant, 
  !(drink_type_significant | study_environment_significant | interaction_significant)
)


explain <- character(4)

explain[1] <- ifelse(drink_type_significant, 
                     "The p-value for drink type is less than 0.05, indicating a significant effect of drink type on alertness.",
                     "The p-value for drink type is greater than 0.05, indicating no significant effect of drink type on alertness.")
                     
explain[2] <- ifelse(study_environment_significant, 
                     "The p-value for study environment is less than 0.05, indicating a significant effect of the study environment on alertness.",
                     "The p-value for study environment is greater than 0.05, indicating no significant effect of study environment on alertness.")
                     
explain[3] <- ifelse(interaction_significant, 
                     "The interaction between drink type and study environment is significant, as the p-value is less than 0.05.",
                     "The p-value for the interaction term is greater than 0.05, indicating no significant interaction between drink type and study environment.")
                     
explain[4] <- "All p-values are greater than 0.05, meaning none of the factors or their interaction significantly affect alertness."


```



Question 
===================
There is a debate about the effects of different drinks and study environments on student alertness. You are determined to end this debate once and for all, to find out which combinations of drinks and study environment makes students the most alert and productive. 


You are conductig a study on student alertness, where students consumed either `Coffee` or `Energy Drink` while studying in one of these 3 environments: `Library`, `Café` or `Bedroom`. The goal of the study is to measure how alert students are in each scenario.

The evaluations are shown in the figure below:
```{r interaction plot, echo = FALSE, results = "hide", fig.height = 3.5, fig.width = 5.8, fig.path = "", fig.cap = ""}
par(mar = c(4, 4, 1, 1))

# Bar Plot: Mean alertness by Drink Type and Study Environment
ggplot(experiment_data, aes(x = StudyEnvironment, y = Alertness, fill = DrinkType)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  labs(x = "Study Environment", y = "Mean Alertness", title = "Mean Alertness by Drink Type and Study Environment") +
  theme_minimal()
```
You are performing a two-way ANOVA to determine if there is a significant effect of drink type and study environment on alertness, as well as any potential interaction. The results are shown below: 

```{r anova output, echo = FALSE, comment = NA}
options(show.signif.stars = FALSE)
print(myanova, quote = FALSE, right = TRUE)

```
Based on the results of the two-way ANOVA, which of the following conclusions are mist appropriate at the 0.05 significance level? 
```{r questionlist, echo = FALSE, results = "asis"}
answerlist(choices, markup = "markdown")
```




Solution
================
The correct answer is 
```{r solutionlist, echo = FALSE, results = "asis"}
answerlist(sol,explain, markup = "markdown")
```



Meta-information
================
extype: mchoice
exsolution: `r mchoice2string(sol)`
exname: anova-two-way-conclusion

