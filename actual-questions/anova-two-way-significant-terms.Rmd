```{r data generation, echo=FALSE, results='hide'}
pacman::p_load(exams, tidyverse)

# Number of participants in the study (students)
num_students <- 10 + sample(1:15, 1)

# Drink Types and study environments
drink_types <- c("Coffee", "Energy Drink")
study_environments <- c("Library", "Café", "Bedroom")

# Create an empty data frame to store the results

experiment_data <- data.frame(Student = integer(),
                              DrinkType = character(),
                              StudyEnvironment = character(),
                              Alertness = numeric())

# Loop over each student
for (i in 1:num_students) {
  # Randomly assign the number of trials per student (between 5 and 15)
  num_samples <- sample(5:15, 1)
  
  # Randomly assign combinations of coffee and study environment
  student_data <- data.frame(
    Student = rep(i, num_samples),
    DrinkType = sample(drink_types, num_samples, replace = TRUE),
    StudyEnvironment = sample(study_environments, num_samples, replace = TRUE)
  )
   student_data$Alertness <- rnorm(num_samples, mean = 30, sd = 2)  # base mean alertness
  # Now simulate alertness based on drink type, study environment, and residual error
 
  
  # Effects for each factor
  # Drink type effect
  student_data$Alertness[student_data$DrinkType == "Coffee"] <- student_data$Alertness[student_data$DrinkType == "Coffee"] + 5
  student_data$Alertness[student_data$DrinkType == "Energy Drink"] <- student_data$Alertness[student_data$DrinkType == "Energy Drink"] + 3
  
  # Study environment effect
  student_data$Alertness[student_data$StudyEnvironment == "Library"] <- student_data$Alertness[student_data$StudyEnvironment == "Library"] + 3
  student_data$Alertness[student_data$StudyEnvironment == "Café"] <- student_data$Alertness[student_data$StudyEnvironment == "Café"] + 2
  student_data$Alertness[student_data$StudyEnvironment == "Bedroom"] <- student_data$Alertness[student_data$StudyEnvironment == "Bedroom"] + 1
  
  # Interaction between DrinkType and StudyEnvironment (this is the crucial part)
  student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Café"] <- 
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Café"] + 4
  student_data$Alertness[student_data$DrinkType == "Energy Drink" & student_data$StudyEnvironment == "Library"] <- 
    student_data$Alertness[student_data$DrinkType == "Energy Drink" & student_data$StudyEnvironment == "Library"] + 2
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Bedroom"] <- 
    student_data$Alertness[student_data$DrinkType == "Coffee" & student_data$StudyEnvironment == "Bedroom"] - 1
  # Add random noise (residual error) to make the data realistic
  student_data$Alertness <- student_data$Alertness + rnorm(num_samples, mean = 0, sd = 10)
  
  # Add the data for the current student to the overall dataset
  experiment_data <- rbind(experiment_data, student_data)
}

myanova <- aov(Alertness ~ DrinkType * StudyEnvironment, data = experiment_data) |> summary()
results <- myanova[[1]] |> as.data.frame() |> round(5)
# QUESTION AND ANSWER GENERATION
choices <- character(4)
choices[1] <- "Drink Type"
choices[2] <- "Study Environment"
choices[3] <- "Interaction term between Drink Type and Study Environment"
choices[4] <- "None of the above"

sol <- results$`Pr(>F)` <0.05
sol[4] <- all(na.omit(results$`Pr(>F)`) >0.05)

explain <- character(4)
explain[1] <- ifelse(sol[1],"", paste0("The p-value of Drink Type is ", results$`Pr(>F)`[1], ", which is greater than 0.05, therefore does not indicate a statistically significant effect"))

explain[2] <- ifelse(sol[2],"", paste0("The p-value of Study Environment is ", results$`Pr(>F)`[2], ", which is greater than 0.05, therefore does not indicate a statistically significant effect"))

explain[3] <- ifelse(sol[3],"", paste0("The p-value of the interaction term between Drink Type and Study Environment is ", results$`Pr(>F)`[3], ", which is greater than 0.05, therefore does not indicate a statistically significant effect"))

explain[4] <- ifelse(sol[3],"", paste0("There is at least one statistically significant term with p-value greater than 0.05"))

```



Question 
===================
There is a debate about the effects of different drinks and study environments on student alertness. You are determined to end this debate once and for all, to find out which combinations of drinks and study environment makes students the most alert and productive. 


You are conductig a study on student alertness, where students consumed either `Coffee` or `Energy Drink` while studying in one of these 3 environments: `Library`, `Café` or `Bedroom`. The goal of the study is to measure how alert students are in each scenario.

The evaluations are shown in the figure below:
```{r interaction plot, echo = FALSE, results = "hide", fig.height = 3.5, fig.width = 5.8, fig.path = "", fig.cap = ""}
par(mar = c(4, 4, 1, 1))

# Bar Plot: Mean alertness by Drink Type and Study Environment
ggplot(experiment_data, aes(x = StudyEnvironment, y = Alertness, fill = DrinkType)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
  labs(x = "Study Environment", y = "Mean Alertness", title = "Mean Alertness by Drink Type and Study Environment") +
  theme_minimal()
```
You are performing a two-way ANOVA to determine if there is a significant effect of drink type and study environment on alertness, as well as any potential interaction. The results are shown below: 

```{r anova output, echo = FALSE, comment = NA}
options(show.signif.stars = FALSE)
print(myanova, quote = FALSE, right = TRUE)

```
Which factor(s) have a statistically significant effect on alertness at the 0.05 significance level? 

```{r questionlist, echo = FALSE, results = "asis"}
answerlist(choices, markup = "markdown")
```




Solution
================
The correct answer is 
```{r solutionlist, echo = FALSE, results = "asis"}
answerlist(sol,explain, markup = "markdown")
```



Meta-information
================
extype: mchoice
exsolution: `r mchoice2string(sol)`
exname: anova-two-way-significant-terms

